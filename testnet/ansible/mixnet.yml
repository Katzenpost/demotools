---
# This playbook deploys the katzenpost mixnet

- name: Build katzenpost binaries locally
  hosts: Builder
  connection: local
  roles:
    - builder
  vars:
    buildTime: "{{ ansible_date_time.iso8601_basic }}"
    buildDir: "{{ ansible_env.PWD }}/{{ buildTime }}"
    serverDestPath: "{{ buildDir}}/server"
    authorityDestPath: "{{ buildDir}}/nonvoting"

- name: Install katzenpost systemd unit on Authority
  remote_user: root
  hosts: Authority
  roles:
    - authority

- name: Install katzenpost systemd unit on Mixes
  remote_user: root
  hosts: Mixes
  roles:
    - mix

- name: Install katzenpost systemd unit on Providers
  remote_user: root
  hosts: Providers
  roles:
    - provider

- name: Update katzenpost on Authority
  remote_user: root
  hosts: Authority
  roles:
    - authority

- name: Update katzenpost on Mixes
  remote_user: root
  hosts: Mixes
  roles:
    - mix

- name: Update katzenpost on Providers
  remote_user: root
  hosts: Providers
  roles:
    - provider
